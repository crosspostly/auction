/**
 * –°–ò–°–¢–ï–ú–ê –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ó–î–û–†–û–í–¨–Ø –ö–û–î–ê (Health Check)
 * –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é runFullLogicDiagnostic(), —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ü–µ–ø–æ—á–∫–∏.
 */

function runFullLogicDiagnostic() {
  Logger.log("üöÄ –ù–ê–ß–ê–õ–û –ì–õ–û–ë–ê–õ–¨–ù–û–ô –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –õ–û–ì–ò–ö–ò");
  
  const mockLot = {
    lot_id: "DIAG_001",
    start_price: 500,
    current_price: 500,
    leader_id: "",
    deadline: "31.12.2026 21:00:00",
    name: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –ª–æ—Ç",
    post_id: "-123_456"
  };

  // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–≤–æ–π —Å—Ç–∞–≤–∫–∏
  Logger.log("\n1. –¢–µ—Å—Ç: –ü–µ—Ä–≤–∞—è —Å—Ç–∞–≤–∫–∞ (500 –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ 500)");
  const v1 = validateBid(500, mockLot, new Date());
  if (v1.isValid) {
    Logger.log("‚úÖ –£–°–ü–ï–•: –ü–µ—Ä–≤–∞—è —Å—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞.");
  } else {
    Logger.log("‚ùå –û–®–ò–ë–ö–ê: –ü–µ—Ä–≤–∞—è —Å—Ç–∞–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞: " + v1.reason);
  }

  // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –ª–∏–¥–µ—Ä–∞
  mockLot.leader_id = "user_1";
  mockLot.current_price = 500;
  Logger.log("\n2. –¢–µ—Å—Ç: –í—Ç–æ—Ä–∞—è —Å—Ç–∞–≤–∫–∞ (500 –ø—Ä–∏ –ª–∏–¥–µ—Ä–µ user_1)");
  const v2 = validateBid(500, mockLot, new Date());
  if (!v2.isValid) {
    Logger.log("‚úÖ –£–°–ü–ï–•: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞ –≤–µ—Ä–Ω–æ.");
  } else {
    Logger.log("‚ùå –û–®–ò–ë–ö–ê: –ë–æ—Ç –ø—Ä–∏–Ω—è–ª —Ç—É –∂–µ —Å—Ç–∞–≤–∫—É –æ—Ç –¥—Ä—É–≥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞.");
  }

  // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ê–Ω—Ç–∏-—Å–Ω–∞–π–ø–µ—Ä–∞
  Logger.log("\n3. –¢–µ—Å—Ç: –†–∞—Å—á–µ—Ç –ê–Ω—Ç–∏-—Å–Ω–∞–π–ø–µ—Ä–∞");
  const commentTime = new Date("2026-12-31T20:55:00"); // –ó–∞ 5 –º–∏–Ω –¥–æ –∫–æ–Ω—Ü–∞
  const deadlineDate = parseRussianDate(mockLot.deadline);
  const timeDiff = (deadlineDate.getTime() - commentTime.getTime()) / 60000;
  
  Logger.log("–û—Å—Ç–∞–ª–æ—Å—å –º–∏–Ω—É—Ç –¥–æ –∫–æ–Ω—Ü–∞: " + timeDiff);
  if (timeDiff <= 10) {
    const newDeadline = new Date(commentTime.getTime() + 600000);
    Logger.log("‚úÖ –£–°–ü–ï–•: –ê–Ω—Ç–∏-—Å–Ω–∞–π–ø–µ—Ä –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–æ—Ç–∞—Ç—å. –ù–æ–≤—ã–π –¥–µ–¥–ª–∞–π–Ω: " + newDeadline.toLocaleString());
  } else {
    Logger.log("‚ùå –û–®–ò–ë–ö–ê: –õ–æ–≥–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∞ –∑–æ–Ω—É –ê–Ω—Ç–∏-—Å–Ω–∞–π–ø–µ—Ä–∞.");
  }

  // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞—Å—Å—ã–ª–∫–∏
  Logger.log("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞—Å—Å—ã–ª–∫–∏");
  const criticalFuncs = ["sendAllSummaries", "sendAdminReport", "checkIfBotReplied", "getSetting", "onOpen"];
  criticalFuncs.forEach(f => {
    // –í Google Apps Script —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º –æ–±—ä–µ–∫—Ç–µ
    if (typeof this[f] === "function" || typeof eval(f) === "function") {
      Logger.log("‚úÖ –§—É–Ω–∫—Ü–∏—è " + f + " –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞.");
    } else {
      Logger.log("‚ùå –û–®–ò–ë–ö–ê: –§—É–Ω–∫—Ü–∏—è " + f + " –ü–†–û–ü–ê–õ–ê –ò–ó –ì–õ–û–ë–ê–õ–¨–ù–û–ô –û–ë–õ–ê–°–¢–ò!");
    }
  });

  Logger.log("\nüèÅ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê. –ï—Å–ª–∏ –≤—Å–µ –ø—É–Ω–∫—Ç—ã ‚úÖ - –∫–æ–¥ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.");
}
