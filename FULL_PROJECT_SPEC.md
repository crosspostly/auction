# –ü–û–õ–ù–ê–Ø –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –°–ü–ï–¶–ò–§–ò–ö–ê–¶–ò–Ø: VK AUCTION CRM (v2.2)

## 1. –û–ë–©–ï–ï –û–ü–ò–°–ê–ù–ò–ï
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∞—É–∫—Ü–∏–æ–Ω–æ–≤ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è **Google –¢–∞–±–ª–∏—Ü—ã** –∫–∞–∫ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –∞ **Google Apps Script** –∫–∞–∫ –±—ç–∫–µ–Ω–¥.

## 2. –°–¢–†–£–ö–¢–£–†–ê –¢–ê–ë–õ–ò–¶–´ (–ë–ê–ó–ê –î–ê–ù–ù–´–•)
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ª–∏—Å—Ç—ã:

### 2.1. –õ–∏—Å—Ç ¬´–õ–æ—Ç—ã¬ª (Config)
–ì–ª–∞–≤–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤. –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–∞ –≤ –í–ö.
*   `lot_id`: ID –ª–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1840).
*   `post_id`: –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ `ownerID_postID`.
*   `name`: –ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ—Ç–∞ (—Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω–æ–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞).
*   `start_price`: –ù–∞—á–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞.
*   `current_price`: –¢–µ–∫—É—â–∞—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞.
*   `leader_id`: VK ID —Ç–µ–∫—É—â–µ–≥–æ –ª–∏–¥–µ—Ä–∞.
*   `status`: –°–æ—Å—Ç–æ—è–Ω–∏–µ (`active`, `sold`, `unsold`, `cancelled`).
*   `created_at`: –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏.
*   `deadline`: –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è (—Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ –∏–∑ –ø–æ—Å—Ç–∞).

### 2.2. –õ–∏—Å—Ç ¬´–°—Ç–∞–≤–∫–∏¬ª (Bids)
–õ–æ–≥ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
*   `bid_id`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
*   `lot_id`: –ö –∫–∞–∫–æ–º—É –ª–æ—Ç—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è.
*   `user_id`: –ö—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–ª.
*   `bid_amount`: –°—É–º–º–∞.
*   `timestamp`: –¢–æ—á–Ω–æ–µ –≤—Ä–µ–º—è —Å—Ç–∞–≤–∫–∏.

### 2.3. –õ–∏—Å—Ç ¬´–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏¬ª (Winners)
–†–µ–µ—Å—Ç—Ä –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —É—á–µ—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏.
*   `lot_id`, `name`, `price`, `winner_id`, `winner_name`.
*   `status`: –≠—Ç–∞–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏ (`pending_contact`, `summary_sent`, `paid`, `shipped`).
*   `delivery`: –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏.

### 2.4. –õ–∏—Å—Ç ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏¬ª (Settings)
–ü—É–±–ª–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.
*   `bid_step_enabled`: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∞—Ç–Ω–æ—Å—Ç–∏ —à–∞–≥–∞ (TRUE/FALSE).
*   `bid_step`: –†–∞–∑–º–µ—Ä —à–∞–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 50).
*   `delivery_rules`: JSON-–ø—Ä–∞–≤–∏–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `{"1-3":450, "4-6":550}`).
*   `order_summary_template`: –®–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ —Å–ø–∏—Å–∫–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (`{LOTS_LIST}`, `{TOTAL_COST}` –∏ —Ç.–¥.).

### 2.5. –û—á–µ—Ä–µ–¥—å –∏ –û—à–∏–±–∫–∏
*   `–û—á–µ—Ä–µ–¥—å (NotificationQueue)`: –ë—É—Ñ–µ—Ä –¥–ª—è –æ–±—Ö–æ–¥–∞ –ª–∏–º–∏—Ç–æ–≤ VK API (–æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —á–∞—â–µ 3 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫).
*   `–û—à–∏–±–∫–∏ (Errors)`: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ª–æ–≥ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

---

## 3. –ò–ù–¢–ï–†–§–ï–ô–° –£–ü–†–ê–í–õ–ï–ù–ò–Ø
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–µ–Ω—é –≤ Google –¢–∞–±–ª–∏—Ü–∞—Ö.

1.  **üöÄ –ú–∞—Å—Ç–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
    *   –°–æ–∑–¥–∞–µ—Ç –≤—Å–µ –ª–∏—Å—Ç—ã.
    *   –ü—Ä–æ–ø–∏—Å—ã–≤–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª–µ–π.
    *   –ó–∞–ø–æ–ª–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
    *   –°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –ª–æ—Ç –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞.
    *   –í–∫–ª—é—á–∞–µ—Ç –º–∏–Ω—É—Ç–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã.
2.  **üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
    *   –ó–∞—â–∏—â–µ–Ω–æ –∞–¥–º–∏–Ω-–ø–∞—Ä–æ–ª–µ–º (—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –Ω–∞ 6 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ 5 –ø–æ–ø—ã—Ç–æ–∫).
    *   –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–≤–æ–¥–∏—Ç—å `VK_TOKEN`, `GROUP_ID`, `Payment Phone/Bank`.
    *   **–ö–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫ –í–ö¬ª**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç Web App URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≥—Ä—É–ø–ø—ã –í–ö.
3.  **üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–∞–π–¥–±–∞—Ä —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ –∏ –ø–æ—à–∞–≥–æ–≤—ã–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º.

---

## 4. –ö–õ–Æ–ß–ï–í–ê–Ø –õ–û–ì–ò–ö–ê
1.  **–ü–∞—Ä—Å–∏–Ω–≥:** –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–æ—Å—Ç–æ–≤ –ª—é–±–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.
2.  **–ê–Ω—Ç–∏-—Å–Ω–∞–π–ø–µ—Ä (TODO):** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ `deadline` –Ω–∞ 10 –º–∏–Ω—É—Ç, –µ—Å–ª–∏ —Å—Ç–∞–≤–∫–∞ —Å–¥–µ–ª–∞–Ω–∞ –º–µ–Ω–µ–µ —á–µ–º –∑–∞ 10 –º–∏–Ω—É—Ç –¥–æ –∫–æ–Ω—Ü–∞.
3.  **Race Condition Protection:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `LockService` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ –¥–≤—É—Ö —Å—Ç–∞–≤–æ–∫ –Ω–∞ –æ–¥–Ω—É –∫–æ–ø–µ–π–∫—É.
4.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—á–∫–∏:** –ï—Å–ª–∏ —É —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏—è, –±–æ—Ç —Ç–µ–≥–∞–µ—Ç –µ–≥–æ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö —Å –ø—Ä–æ—Å—å–±–æ–π –æ—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø.

---

## 5. –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ü–ê–†–ê–ú–ï–¢–†–´
*   **Web App URL:** –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –¥–ª—è Callback API.
*   **Scopes:** –î–æ—Å—Ç—É–ø –∫ Spreadsheets, External Requests, Forms.
*   **Trigger:** `processNotificationQueue` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É.
