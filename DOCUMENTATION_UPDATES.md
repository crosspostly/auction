# Обновления документации для VK Аукционного Бота

## 1. Улучшения в системе шаблонов сообщений

### 1.1. Все сообщения теперь считываются из листа настроек

Ранее в системе использовались захардкоженные сообщения, которые были встроены в код. Теперь все сообщения, которые отправляет бот, считываются из листа настроек в Google Таблице.

### 1.2. Новые шаблоны, добавленные в систему

- `winner_comment_template` - шаблон комментария о победе с упоминанием пользователя
- `unsold_lot_comment_template` - шаблон комментария для не проданного лота

### 1.3. Обновленные функции для работы с шаблонами

- `buildWinnerCommentMessage()` - создает сообщение о победе с подстановкой даты, ID пользователя и имени
- `buildUnsoldLotCommentMessage()` - создает сообщение о непроданном лоте
- Все существующие функции (`buildOutbidMessage`, `buildWinnerMessage`, `buildLowBidMessage`, и т.д.) теперь используют шаблоны из настроек

## 2. Улучшения в логике обработки сообщений

### 2.1. Улучшена логика распознавания информации для доставки

- Более строгие регулярные выражения для распознавания телефонов, ФИО и адресов
- Требование наличия как минимум 2 из 3 признаков (телефон, ФИО, адрес) для отправки сообщения "Спасибо, данные для доставки приняты!"
- Проверка минимальной длины сообщения (10 символов)
- Дополнительная проверка, что сообщение не является командой "АУКЦИОН"

### 2.2. Улучшена защита от ложных срабатываний

- Добавлена дополнительная проверка в начало функции `handleMessageNew` для подтверждения, что это реальное сообщение от пользователя
- Улучшенные логи для диагностики ложных срабатываний

## 3. Улучшения в системе дедупликации уведомлений

- Расширенная логика в `queueNotification` для предотвращения дублирования уведомлений
- Проверка на наличие недавно отправленных уведомлений (в течение последних 5 минут)
- Логирование событий, когда дублирование уведомлений предотвращается

## 4. Архитектурные изменения

### 4.1. Централизация управления сообщениями

Все сообщения теперь управляются через лист "Настройки" в Google Таблице, что позволяет:
- Администраторам легко изменять тексты сообщений без изменения кода
- Быстро адаптировать сообщения под нужды конкретного сообщества
- Упрощает тестирование различных вариантов сообщений

### 4.2. Совместимость

Все изменения обратно совместимы - если шаблон не найден в настройках, используется значение по умолчанию, как и раньше.