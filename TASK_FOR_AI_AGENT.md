### Техническое задание для ИИ-агента

**Проект:** VK Auction Bot
**Версия:** 2.3 (на базе Google Apps Script)
**Дата:** 12.02.2026

#### 1. Текущее состояние системы ("что есть")

*   **Архитектура:** Система построена на Google Apps Script и Google Sheets, взаимодействует с VK API через веб-хуки. Обработка событий (новые посты, комментарии) реализована асинхронно через очередь (`EventQueue`).
*   **Основной функционал:** Создание лотов, прием и валидация ставок, завершение аукциона, автоматическое общение с победителями в ЛС — реализованы и частично протестированы.
*   **Тестовое окружение:** Существует скрипт `deploy_and_test.sh`, который автоматизирует развертывание и запускает функцию `runFullCycleSimulation` для интеграционного тестирования с реальным VK API.
*   **Обнаруженные проблемы:**
    1.  **Критическая ошибка в фоновом мониторинге:** Периодическая задача `periodicSystemCheck` аварийно завершается с ошибкой `TypeError: Cannot read properties of undefined (reading 'name')`. Это указывает на нестабильность системы в долгосрочной перспективе.
    2.  **Нестабильность интеграционных тестов:** Предыдущие запуски `deploy_and_test.sh` завершались с различными ошибками (`Lot not found`, `Bid not found`, таймауты), что указывает на фундаментальные проблемы с обработкой данных или кэшированием в тестовом режиме.

#### 2. Поставленная задача ("что надо")

**Основная цель:** Обеспечить 100% стабильность и надежность системы, подтвержденную полным прохождением автоматизированных тестов, и подготовить проект к передаче.

**Шаги для выполнения:**

1.  **Устранить ошибку фонового мониторинга:**
    *   **Задача:** Найти и исправить причину ошибки `TypeError: Cannot read properties of undefined (reading 'name')` в функции `periodicSystemCheck` или в вызываемых ею функциях (`continuousMonitoring`, `systemHealthCheck`).
    *   **Гипотеза:** Вероятнее всего, в одной из проверок (например, `checkRequiredSheets`) используется некорректный ключ для доступа к объекту `SHEETS`, что возвращает `undefined`.
    *   **Действия:**
        1.  Проанализировать стек вызовов, начиная с `periodicSystemCheck`.
        2.  Проверить все циклы, которые итерируются по конфигурации `SHEETS`, на предмет наличия ключей.
        3.  Внести исправление.

2.  **Добиться полного прохождения интеграционного теста:**
    *   **Задача:** Обеспечить стабильное выполнение скрипта `deploy_and_test.sh` от начала до конца без таймаутов и логических ошибок.
    *   **Критерий успеха:** Вывод скрипта содержит строку `✅ FULL CYCLE SIMULATION COMPLETED SUCCESSFULLY!` и завершается с кодом выхода 0.
    *   **Действия:**
        1.  После исправления ошибки мониторинга запустить `deploy_and_test.sh`.
        2.  В случае возникновения любых других ошибок (связанных с кэшем, записью в таблицу и т.д.), систематически диагностировать и устранять их.
        3.  Убедиться, что исправленная логика кэширования (отключение кэша для неинтерактивных сессий) работает корректно и не вызывает зависаний.

3.  **Финализация:**
    *   **Задача:** Убрать из кода весь временный отладочный код (выводы в лог, искусственные задержки, тестовые фрагменты), который был добавлен в процессе решения проблем.
    *   **Действия:** Провести ревизию файлов `AuctionSimulator.gs` и `Sheets.gs`, удалить все `L('DEBUG: ...')` и подобные отладочные вызовы, которые не являются необходимыми для штатного логирования.
