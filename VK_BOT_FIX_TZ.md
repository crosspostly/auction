# ТЕХНИЧЕСКОЕ ЗАДАНИЕ: ИСПРАВЛЕНИЕ СВЯЗИ VK -> GOOGLE SHEETS

## 1. СУТЬ ПРОБЛЕМЫ
Бот успешно отправляет команды в ВК (публикует посты), но **не получает** данные от ВК. 
ВК помечает сервер как `failed`. Это происходит из-за того, что функция `doPost(e)` в Google Apps Script не возвращает `confirmation_code` вовремя или в правильном формате.

## 2. ЧТО ПРОВЕРЕНО ЛОКАЛЬНО
Локальный скрипт на Python подтвердил:
1. Токен ВК (access_token) — РАБОЧИЙ.
2. ID Группы (96798355) — РАБОЧИЙ.
3. Сервер Callback API в ВК зарегистрирован (ID 11), но статус `failed`.
4. Галочки событий (посты, комменты) — ВКЛЮЧЕНЫ.

## 3. ЗАДАЧИ ДЛЯ ИСПРАВЛЕНИЯ

### Задача №1: Гарантировать ответ Confirmation
В файле `Code.gs` функция `doPost(e)` должна БЕЗУСЛОВНО и МГНОВЕННО возвращать код подтверждения. 
Проблема может быть в том, что `PropertiesService` внутри `doPost` иногда тормозит.
**Решение:** Хардкодно (временно) вписать код подтверждения в `doPost` для теста, чтобы исключить влияние базы данных.

### Задача №2: Проверка типа контента
Убедиться, что `ContentService.createTextOutput(code)` не добавляет лишних заголовков или HTML-тегов. ВК ждет чистую строку.

### Задача №3: Логирование входящих данных
Добавить запись КАЖДОГО входящего запроса в отдельный лист "Debug_Incoming". 
Если лист пустой после нажатия кнопки "Подтвердить" в ВК — значит, Google Cloud блокирует запросы на уровне файервола (нужно проверить настройки Scopes в `appsscript.json`).

## 4. ИНСТРУКЦИЯ ДЛЯ ТЕСТА (БЕЗ ВК)
Использовать команду в терминале для имитации ВК:
`curl -L -X POST "URL_СКРИПТА" -d '{"type":"confirmation", "group_id":96798355}'`
Бот ДОЛЖЕН вернуть только код подтверждения и ничего больше.
