# –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï: –í–ö –ë–û–¢ –î–õ–Ø –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–ò –ê–£–ö–¶–ò–û–ù–û–í

**–í–µ—Ä—Å–∏—è:** 2.0  
**–î–∞—Ç–∞:** 06.02.2026  
**–°—Ç–∞—Ç—É—Å:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** Google Apps Script + Google Sheets + VK Callback API  

---

## 1. –í–í–ï–î–ï–ù–ò–ï

### 1.1 –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –±–æ—Ç–∞ –¥–ª—è –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤ –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–µ:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤-–ª–æ—Ç–æ–≤ —á–µ—Ä–µ–∑ Callback API
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–≤–æ–∫ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ –ø–µ—Ä–µ–±–∏—Ç—ã—Ö —Å—Ç–∞–≤–∫–∞—Ö
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Google Sheets –±–µ–∑ –≤–µ–±-–∞–¥–º–∏–Ω–∫–∏

### 1.2 –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Å–æ–æ–±—â–µ—Å—Ç–≤–∞:**
- –ü—É–±–ª–∏–∫—É—é—Ç –ø–æ—Å—Ç—ã —Å –ª–æ—Ç–∞–º–∏ (—Ñ–∏–≥—É—Ä–∫–∏/—Ç–æ–≤–∞—Ä—ã)
- –£–ø—Ä–∞–≤–ª—è—é—Ç –∞—É–∫—Ü–∏–æ–Ω–æ–º —á–µ—Ä–µ–∑ Google –¢–∞–±–ª–∏—Ü—É
- –ü–æ–ª—É—á–∞—é—Ç –∏—Ç–æ–≥–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã

**–£—á–∞—Å—Ç–Ω–∏–∫–∏ –∞—É–∫—Ü–∏–æ–Ω–∞:**
- –î–µ–ª–∞—é—Ç —Å—Ç–∞–≤–∫–∏ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∫ –ø–æ—Å—Ç–∞–º
- –ü–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç –±–æ—Ç–∞
- –ü–∏—à—É—Ç –≤ –õ–° –≥—Ä—É–ø–ø—ã –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞

### 1.3 –ú–∞—Å—à—Ç–∞–± –∏ –Ω–∞–≥—Ä—É–∑–∫–∞

**–¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- –õ–æ—Ç–æ–≤ –∑–∞ –∞—É–∫—Ü–∏–æ–Ω: 15
- –ê—É–∫—Ü–∏–æ–Ω–æ–≤ –≤ –º–µ—Å—è—Ü: 4 (–∫–∞–∂–¥—É—é —Å—É–±–±–æ—Ç—É)
- –°—Ç–∞–≤–æ–∫ –∑–∞ –∞—É–∫—Ü–∏–æ–Ω: 30-100
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ (–ø–∏–∫): –¥–æ 10
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞ –∞—É–∫—Ü–∏–æ–Ω: 50-150

### 1.4 –ì–ª–æ—Å—Å–∞—Ä–∏–π

| –¢–µ—Ä–º–∏–Ω | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| **–õ–æ—Ç** | –¢–æ–≤–∞—Ä, –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω (–æ–¥–∏–Ω –ø–æ—Å—Ç = –æ–¥–∏–Ω –ª–æ—Ç) |
| **–°—Ç–∞–≤–∫–∞** | –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç—É |
| **–ü–æ–±–µ–¥–∏—Ç–µ–ª—å** | –£—á–∞—Å—Ç–Ω–∏–∫ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–æ–π –Ω–∞ –º–æ–º–µ–Ω—Ç –æ–∫–æ–Ω—á–∞–Ω–∏—è |
| **–ê—É–∫—Ü–∏–æ–Ω** | –°–µ—Ä–∏—è –∏–∑ 15 –ª–æ—Ç–æ–≤, –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –ø–æ —Å—É–±–±–æ—Ç–∞–º |
| **GAS** | Google Apps Script ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ª–æ–≥–∏–∫–∏ |
| **Callback API** | VK API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –≤ real-time —á–µ—Ä–µ–∑ webhook |
| **user_id** | –ß–∏—Å–ª–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –í–ö–æ–Ω—Ç–∞–∫—Ç–µ |
| **post_id** | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ—Å—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `-GROUP_ID_POST_ID` |
| **doPost()** | Entry point —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook –æ—Ç VK |
| **Lock** | –ú–µ—Ö–∞–Ω–∏–∑–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç race conditions |

---

## 2. –û–ë–©–ï–ï –û–ü–ò–°–ê–ù–ò–ï –°–ò–°–¢–ï–ú–´

### 2.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          –£–†–û–í–ï–ù–¨ 1: VK (–∏—Å—Ç–æ—á–Ω–∏–∫ —Å–æ–±—ã—Ç–∏–π)               ‚îÇ
‚îÇ  ‚Ä¢ –ù–æ–≤—ã–µ –ø–æ—Å—Ç—ã –Ω–∞ —Å—Ç–µ–Ω–µ (wall_post_new)                 ‚îÇ
‚îÇ  ‚Ä¢ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º (wall_reply_new)                ‚îÇ
‚îÇ  ‚Ä¢ –õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (message_new)                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ Callback API (webhook, 5 —Å–µ–∫ timeout)
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      –£–†–û–í–ï–ù–¨ 2: Google Apps Script (–ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞)        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ doPost(e) ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç "ok" –∑–∞ < 2 —Å–µ–∫   ‚îÇ    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îÇ
‚îÇ  ‚îÇ –ú–æ–¥—É–ª–∏:                                        ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ PostTracker ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤      ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ BidProcessor ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞–≤–æ–∫ —Å Lock       ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ NotificationQueue ‚Äî –æ—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π      ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ WinnerManager ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π      ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ ReportGenerator ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤       ‚îÇ    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îÇ
‚îÇ  ‚îÇ –¢—Ä–∏–≥–≥–µ—Ä—ã:                                      ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Time-based: –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (–æ—á–µ—Ä–µ–¥—å)          ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Time-based: —Å—É–±–±–æ—Ç–∞ 21:00 (–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)       ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        –£–†–û–í–ï–ù–¨ 3: Google Sheets (—Ö—Ä–∞–Ω–∏–ª–∏—â–µ)             ‚îÇ
‚îÇ  ‚Ä¢ –õ–∏—Å—Ç "–ö–æ–Ω—Ñ–∏–≥" ‚Äî –º–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ –ª–æ—Ç–æ–≤                    ‚îÇ
‚îÇ  ‚Ä¢ –õ–∏—Å—Ç "–°—Ç–∞–≤–∫–∏" ‚Äî –∂—É—Ä–Ω–∞–ª –≤—Å–µ—Ö —Å—Ç–∞–≤–æ–∫                   ‚îÇ
‚îÇ  ‚Ä¢ –õ–∏—Å—Ç "–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏" ‚Äî –∏—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞                 ‚îÇ
‚îÇ  ‚Ä¢ –õ–∏—Å—Ç "–û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π" ‚Äî pending notifications   ‚îÇ
‚îÇ  ‚Ä¢ –õ–∏—Å—Ç "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–æ—Ç–∞                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         –£–†–û–í–ï–ù–¨ 4: VK API (–∏—Å—Ö–æ–¥—è—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è)          ‚îÇ
‚îÇ  ‚Ä¢ messages.send ‚Äî –õ–° —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (rate limit 3/sec)    ‚îÇ
‚îÇ  ‚Ä¢ wall.createComment ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º–∏      ‚îÇ
‚îÇ  ‚Ä¢ groups.isMember ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏                  ‚îÇ
‚îÇ  ‚Ä¢ users.get ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –§–ò–û –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2.2 –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|-----------|------------|-------------|
| **–°–µ—Ä–≤–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞** | Google Apps Script (JavaScript ES6) | –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥, –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Sheets, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π HTTPS, 20k URL Fetch/–¥–µ–Ω—å |
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | Google Sheets | –ü—Ä–æ—Å—Ç–æ—Ç–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∞, –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤, –±–µ—Å–ø–ª–∞—Ç–Ω–æ –Ω–∞–≤—Å–µ–≥–¥–∞ |
| **VK –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** | Callback API + VK API 5.199 | Real-time —Å–æ–±—ã—Ç–∏—è, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ "ok" –∑–∞ 5 —Å–µ–∫, –ª–∏–º–∏—Ç 3 req/sec |
| **–ó–∞—â–∏—Ç–∞ –æ—Ç race conditions** | LockService (GAS) | –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ç–∞–≤–∫–∞—Ö, –≤—Å—Ç—Ä–æ–µ–Ω –≤ GAS, timeout 30 —Å–µ–∫ |
| **Rate limiting** | –û—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 350ms | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ VK API –ª–∏–º–∏—Ç—É 3 req/sec (350ms = 2.85/sec –±–µ–∑–æ–ø–∞—Å–Ω–æ) |
| **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** | Time-driven triggers + –û—á–µ—Ä–µ–¥—å | –û—Ç–≤–µ—Ç VK –∑–∞ < 2 —Å–µ–∫, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É, –Ω–µ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö |
| **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á** | Time-driven triggers (GAS) | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞ –≤ 21:00 –∫–∞–∂–¥—É—é —Å—É–±–±–æ—Ç—É, –æ—á–∏—Å—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É |

---

## 3. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –ò –†–ï–®–ï–ù–ò–Ø

### 3.1 VK Callback API Timeout (5 —Å–µ–∫—É–Ω–¥)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- VK —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–≤–µ—Ç `"ok"` –≤ —Ç–µ—á–µ–Ω–∏–µ **5 —Å–µ–∫—É–Ω–¥**
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è (√ó5 –ø–æ–ø—ã—Ç–æ–∫)
- –†–∏—Å–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è: –æ–¥–Ω–∞ —Å—Ç–∞–≤–∫–∞ –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è 5 —Ä–∞–∑

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    
    // 1. Confirmation (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
    if (data.type === 'confirmation') {
      return ContentService.createTextOutput(CONFIRMATION_CODE);
    }
    
    // 2. –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞–≤–æ–∫ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, < 2 —Å–µ–∫)
    if (data.type === 'wall_reply_new') {
      processBidFast(data); // –¢–æ–ª—å–∫–æ –∑–∞–ø–∏—Å—å –≤ Sheets
    }
    
    // 3. –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –æ—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (< 0.5 —Å–µ–∫)
    if (needsNotification(data)) {
      queueNotification(data);
    }
    
    // 4. –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç VK
    return ContentService.createTextOutput('ok');
    
  } catch (err) {
    Logger.log('doPost error: ' + err);
    return ContentService.createTextOutput('ok'); // –í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ–º ok
  }
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –û—Ç–≤–µ—Ç VK –∑–∞ < 2 —Å–µ–∫—É–Ω–¥—ã (–≤ 2.5 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ –ª–∏–º–∏—Ç–∞)
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –°—Ç–∞–≤–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (real-time —Ç–∞–±–ª–∏—Ü–∞)
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–∑–∞–¥–µ—Ä–∂–∫–∞ 1-3 –º–∏–Ω—É—Ç—ã)

---

### 3.2 Google Apps Script Quotas

| –õ–∏–º–∏—Ç | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞—à–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ | –°—Ç–∞—Ç—É—Å |
|-------|----------|---------------|--------|
| **URL Fetch calls/–¥–µ–Ω—å** | 20,000 | ~300/–¥–µ–Ω—å (4 –∞—É–∫—Ü–∏–æ–Ω–∞ √ó 75 –∑–∞–ø—Ä–æ—Å–æ–≤) | ‚úÖ 1.5% |
| **Script runtime (–æ–¥–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)** | 6 –º–∏–Ω—É—Ç | < 10 —Å–µ–∫ (doPost) | ‚úÖ 2.7% |
| **doPost concurrent** | 30 | < 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–ø–∏–∫) | ‚úÖ 33% |
| **Total runtime/–¥–µ–Ω—å** | 90 –º–∏–Ω—É—Ç | ~5 –º–∏–Ω—É—Ç/–¥–µ–Ω—å | ‚úÖ 5.5% |
| **Triggers total** | 20 | 2 (–æ—á–µ—Ä–µ–¥—å + –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ) | ‚úÖ 10% |
| **Spreadsheet read/write** | –ë–µ–∑ –ª–∏–º–∏—Ç–∞ | ~500/–¥–µ–Ω—å | ‚úÖ OK |

**–í—ã–≤–æ–¥:** –í—Å–µ –ª–∏–º–∏—Ç—ã —Å–æ–±–ª—é–¥–µ–Ω—ã —Å –∑–∞–ø–∞—Å–æ–º √ó10-100.

---

### 3.3 VK API Rate Limiting (3 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –õ–∏–º–∏—Ç VK API: 3 –∑–∞–ø—Ä–æ—Å–∞ –≤ —Å–µ–∫—É–Ω–¥—É
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ ‚Äî 429 Too Many Requests
- –ù—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å 15 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º –∑–∞ 1 –º–∏–Ω—É—Ç—É

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
class VKApiQueue {
  constructor() {
    this.queue = [];
    this.processing = false;
  }
  
  add(method, params) {
    this.queue.push({ method, params, timestamp: Date.now() });
  }
  
  process() {
    if (this.processing || this.queue.length === 0) return;
    
    this.processing = true;
    
    while (this.queue.length > 0) {
      const task = this.queue.shift();
      
      try {
        callVkApi(task.method, task.params);
      } catch (err) {
        if (err.code === 429) {
          // –í–µ—Ä–Ω—É—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å
          this.queue.unshift(task);
          Utilities.sleep(1000);
        }
      }
      
      Utilities.sleep(350); // 350ms = 2.85 req/sec (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
    }
    
    this.processing = false;
  }
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ 3/—Å–µ–∫ (–∏—Å–ø–æ–ª—å–∑—É–µ–º 2.85/—Å–µ–∫)
- ‚úÖ Retry –ø—Ä–∏ 429 –æ—à–∏–±–∫–µ (√ó3 –ø–æ–ø—ã—Ç–∫–∏)
- ‚úÖ 15 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –∑–∞ ~6 —Å–µ–∫—É–Ω–¥

---

### 3.4 –ó–∞—â–∏—Ç–∞ –æ—Ç Race Conditions (LockService)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –î–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–µ–ª–∞—é—Ç —Å—Ç–∞–≤–∫—É 500‚ÇΩ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ë–µ–∑ Lock: –æ–±–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è, –¥–≤–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
function processBidFast(data) {
  const lock = LockService.getScriptLock();
  
  try {
    // –ñ–¥—ë–º Lock –º–∞–∫—Å–∏–º—É–º 3 —Å–µ–∫—É–Ω–¥—ã (—á—Ç–æ–±—ã —É–ª–æ–∂–∏—Ç—å—Å—è –≤ 5 —Å–µ–∫ VK)
    if (!lock.tryLock(3000)) {
      Logger.log('Lock timeout ‚Äî skip bid');
      return;
    }
    
    const postId = data.object.post_id;
    const userId = data.object.from_id;
    const bid = extractBidAmount(data.object.text);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–∏
    const currentMax = getCurrentMaxBid(postId);
    
    if (bid <= currentMax) {
      Logger.log(`Bid ${bid} <= ${currentMax} ‚Äî ignored`);
      return;
    }
    
    // –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å
    saveBidToSheet(postId, userId, bid, data.object.id);
    
    // –ü–æ–º–µ—Ç–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –ª–∏–¥–µ—Ä–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    if (currentMax > 0) {
      const oldLeader = getCurrentLeader(postId);
      queueNotification(oldLeader, postId, bid);
    }
    
  } finally {
    lock.releaseLock();
  }
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Å—Ç–∞–≤–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
- ‚úÖ Timeout 3 —Å–µ–∫ (< 5 —Å–µ–∫ VK –ª–∏–º–∏—Ç)

---

## 4. –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 4.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤

**ID:** FR-001  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**Event:** `wall_post_new`  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã –Ω–∞ —Å—Ç–µ–Ω–µ –≥—Ä—É–ø–ø—ã —á–µ—Ä–µ–∑ Callback API –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∏—Ö –≤ —Ç–∞–±–ª–∏—Ü—É "–ö–æ–Ω—Ñ–∏–≥" –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–µ –ª–æ—Ç—ã.

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

–ü–æ—Å—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –±–∞–∑—É, –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã **–í–°–ï** —É—Å–ª–æ–≤–∏—è:
1. ‚úÖ –°–æ–±—ã—Ç–∏–µ `wall_post_new` –æ—Ç VK
2. ‚úÖ –ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω **–æ—Ç –∏–º–µ–Ω–∏ –≥—Ä—É–ø–ø—ã** (`from_id = -GROUP_ID`)
3. ‚úÖ –í —Ç–µ–∫—Å—Ç–µ –ø–æ—Å—Ç–∞ –µ—Å—Ç—å **–º–∞—Ä–∫–µ—Ä** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `#–∞—É–∫—Ü–∏–æ–Ω`)
4. ‚úÖ –ü–æ—Å—Ç **–Ω–µ –∑–∞–∫—Ä–µ–ø–ª—ë–Ω** (pinned = 0)
5. ‚úÖ –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ **—Å–µ–≥–æ–¥–Ω—è** (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å—Ç–∞—Ä—ã—Ö –ø–æ—Å—Ç–æ–≤)

#### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–æ—Å—Ç–∞

–ë–æ—Ç –ø–∞—Ä—Å–∏—Ç —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç:

| –ü–æ–ª–µ | Regex / –õ–æ–≥–∏–∫–∞ | –ü—Ä–∏–º–µ—Ä |
|------|----------------|--------|
| **–ù–æ–º–µ—Ä –ª–æ—Ç–∞** | `/#(\d+)/` –∏–ª–∏ `/‚Ññ(\d+)/` –∏–ª–∏ `/–õ–æ—Ç\s+(\d+)/i` | 1691 |
| **–ù–∞–∑–≤–∞–Ω–∏–µ** | –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Ç–µ–∫—Å—Ç–∞ (–¥–æ `\n`) –∏–ª–∏ –ø–æ—Å–ª–µ "–ù–∞–∑–≤–∞–Ω–∏–µ:" | "–§–∏–≥—É—Ä–∫–∞ Space Marine" |
| **–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞** | `/–°—Ç–∞—Ä—Ç[:\s]+(\d+)/i` –∏–ª–∏ `/(\d+)\s*‚ÇΩ/` –∏–ª–∏ `/–æ—Ç\s+(\d+)/i` | 300 |
| **–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è** | –ò–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 21:00) | 21:00 |

**Fallback:** –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã:
- –ù–æ–º–µ—Ä –ª–æ—Ç–∞ = `AUTO_` + –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä (AUTO_1, AUTO_2...)
- –ù–∞–∑–≤–∞–Ω–∏–µ = "–õ–æ—Ç –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"
- –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ = –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100‚ÇΩ)

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –û–±—Ä–∞–±–æ—Ç–∫–∞: < 1 —Å–µ–∫—É–Ω–¥–∞
- –û—Ç–≤–µ—Ç VK: < 2 —Å–µ–∫—É–Ω–¥—ã (–≥–∞—Ä–∞–Ω—Ç–∏—è)

---

### 4.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞–≤–æ–∫ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö

**ID:** FR-002  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π  
**Event:** `wall_reply_new`  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ë–æ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º-–ª–æ—Ç–∞–º, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å—Ç–∞–≤–∫–∏ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –±–∞–∑—É —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç race conditions.

#### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—É–º–º—ã —Å—Ç–∞–≤–∫–∏

```javascript
function extractBidAmount(text) {
  // –í–∞—Ä–∏–∞–Ω—Ç—ã: "500", "500‚ÇΩ", "500 —Ä—É–±", "—Å—Ç–∞–≤–∫–∞ 500"
  const patterns = [
    /^(\d{3,6})$/,           // –¢–æ–ª—å–∫–æ —á–∏—Å–ª–æ
    /^(\d{3,6})\s*‚ÇΩ/,        // –ß–∏—Å–ª–æ —Å —Ä—É–±–ª—è–º–∏
    /^(\d{3,6})\s*—Ä—É–±/i,     // –ß–∏—Å–ª–æ —Å "—Ä—É–±"
    /—Å—Ç–∞–≤–∫–∞\s+(\d{3,6})/i    // "—Å—Ç–∞–≤–∫–∞ 500"
  ];
  
  for (const pattern of patterns) {
    const match = text.trim().match(pattern);
    if (match) return parseInt(match[1]);
  }
  
  return null; // –ù–µ —Å—Ç–∞–≤–∫–∞
}
```

#### –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç–∞–≤–∫–∏

| –ü—Ä–æ–≤–µ—Ä–∫–∞ | –£—Å–ª–æ–≤–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ |
|----------|---------|----------------------|
| **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞** | `bid >= start_price` | –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å |
| **–®–∞–≥ —Å—Ç–∞–≤–∫–∏** | `bid % 50 === 0` (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ) | –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å |
| **–í—ã—à–µ —Ç–µ–∫—É—â–µ–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π** | `bid > currentMaxBid` | –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å |
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ª–∏–¥–µ—Ä** | `userId !== currentLeaderId` | –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å |
| **–ê—É–∫—Ü–∏–æ–Ω –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω** | `now < end_time` | –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å |

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å Lock (–ø–æ–ª–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º)

```javascript
function processBidFast(data) {
  const lock = LockService.getScriptLock();
  
  try {
    // 1. –ü–æ–ª—É—á–∏—Ç—å Lock (–º–∞–∫—Å–∏–º—É–º 3 —Å–µ–∫)
    if (!lock.tryLock(3000)) {
      Logger.log('Lock timeout');
      return;
    }
    
    // 2. –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ
    const postId = `${data.object.post_owner_id}_${data.object.post_id}`;
    const userId = data.object.from_id;
    const commentText = data.object.text;
    const commentId = data.object.id;
    const timestamp = new Date(data.object.date * 1000);
    
    // 3. –ü–∞—Ä—Å–∏–Ω–≥ —Å—É–º–º—ã
    const bid = extractBidAmount(commentText);
    if (!bid) return; // –ù–µ —Å—Ç–∞–≤–∫–∞
    
    // 4. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ –ª–æ—Ç–∞
    const lot = getLotConfig(postId);
    if (!lot || lot.status !== 'active') return;
    
    // 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è
    if (timestamp > lot.end_time) {
      Logger.log('Auction ended');
      return;
    }
    
    // 6. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã
    if (bid < lot.start_price) return;
    if (getConfigValue('bid_step_enabled') && bid % 50 !== 0) return;
    
    // 7. –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Å—Ç–∞–≤–∫—É
    const currentMax = getCurrentMaxBid(postId);
    const currentLeader = getCurrentLeader(postId);
    
    // 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ–ª—å—à–µ —Ç–µ–∫—É—â–µ–π
    if (bid <= currentMax) {
      Logger.log(`Bid ${bid} <= ${currentMax}`);
      return;
    }
    
    // 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ª–∏–¥–µ—Ä–∞
    if (userId === currentLeader) {
      Logger.log('User is already leader');
      return;
    }
    
    // 10. –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å
    const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName('–°—Ç–∞–≤–∫–∏');
    sheet.appendRow([
      sheet.getLastRow() + 1,  // id
      new Date(),              // auction_date
      postId,                  // post_id
      userId,                  // user_id
      bid,                     // bid
      timestamp,               // timestamp
      commentId,               // comment_id
      'valid'                  // status
    ]);
    
    // 11. –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –æ—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (—Å—Ç–∞—Ä–æ–º—É –ª–∏–¥–µ—Ä—É)
    if (currentLeader && currentLeader !== userId) {
      queueNotification({
        user_id: currentLeader,
        post_id: postId,
        old_bid: currentMax,
        new_bid: bid,
        lot_name: lot.name
      });
    }
    
  } finally {
    lock.releaseLock();
  }
}
```

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –û–±—Ä–∞–±–æ—Ç–∫–∞: < 1.5 —Å–µ–∫—É–Ω–¥—ã (—Å Lock)
- –û—Ç–≤–µ—Ç VK: < 2 —Å–µ–∫—É–Ω–¥—ã (–≥–∞—Ä–∞–Ω—Ç–∏—è)
- Concurrent: –¥–æ 30 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

---

### 4.3 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–µ—Ä–µ–±–∏—Ç—ã—Ö —Å—Ç–∞–≤–∫–∞—Ö (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)

**ID:** FR-003  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π  
**Trigger:** Time-based (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –¢—Ä–∏–≥–≥–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å debounce –∏ rate limiting.

#### –õ–∏—Å—Ç "–û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"

| A: id | B: user_id | C: post_id | D: old_bid | E: new_bid | F: lot_name | G: queued_at | H: status |
|-------|------------|------------|------------|------------|-------------|--------------|-----------|
| 1 | 12345 | -123_456 | 500 | 550 | –§–∏–≥—É—Ä–∫–∞ | 2026-02-08 14:30 | pending |

#### Debounce (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)

**–ü—Ä–∞–≤–∏–ª–æ:** –û–¥–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ –æ–¥–Ω–æ–º—É –ª–æ—Ç—É ‚Äî **–Ω–µ —á–∞—â–µ 1 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ 2 –º–∏–Ω—É—Ç—ã**.

```javascript
function shouldNotifyUser(userId, postId) {
  const lastNotification = getLastNotificationTime(userId, postId);
  const now = new Date();
  const diff = (now - lastNotification) / 1000; // —Å–µ–∫—É–Ω–¥—ã
  
  return diff > 120; // 2 –º–∏–Ω—É—Ç—ã
}
```

#### –¢—Ä–∏–≥–≥–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏

```javascript
function processNotificationQueue() {
  const lock = LockService.getScriptLock();
  if (!lock.tryLock(5000)) return; // –£–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
  
  try {
    const sheet = SpreadsheetApp.openById(SHEET_ID)
      .getSheetByName('–û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');
    
    const data = sheet.getDataRange().getValues();
    const pending = data.filter(row => row[7] === 'pending');
    
    const vkQueue = new VKApiQueue();
    
    pending.forEach(notification => {
      // Debounce check
      if (!shouldNotifyUser(notification[1], notification[2])) {
        return;
      }
      
      // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
      const message = `üîî –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –ø–µ—Ä–µ–±–∏—Ç–∞!\n\n` +
        `–õ–æ—Ç: ${notification[5]}\n` +
        `–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞: ${notification[3]}‚ÇΩ\n` +
        `–ù–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞: ${notification[4]}‚ÇΩ\n\n` +
        `–°–¥–µ–ª–∞–π—Ç–µ –Ω–æ–≤—É—é —Å—Ç–∞–≤–∫—É: https://vk.com/wall${notification[2]}`;
      
      // –î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å VK API
      vkQueue.add('messages.send', {
        user_id: notification[1],
        message: message,
        random_id: Date.now()
      });
      
      // –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
      markNotificationAsSent(notification[0]);
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—á–µ—Ä–µ–¥—å VK (—Å rate limiting)
    vkQueue.process();
    
  } finally {
    lock.releaseLock();
  }
}
```

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ß–∞—Å—Ç–æ—Ç–∞: –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- –û–±—Ä–∞–±–æ—Ç–∫–∞ 50 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: ~20 —Å–µ–∫—É–Ω–¥ (350ms √ó 50 = 17.5 —Å–µ–∫)
- –ó–∞–¥–µ—Ä–∂–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: 1-3 –º–∏–Ω—É—Ç—ã (—Å—Ä–µ–¥–Ω–µ–µ 2 –º–∏–Ω—É—Ç—ã)

---

### 4.4 –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π

**ID:** FR-004  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π  
**Trigger:** Time-based (–∫–∞–∂–¥—É—é —Å—É–±–±–æ—Ç—É –≤ 21:00)  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∞—É–∫—Ü–∏–æ–Ω, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –ø–æ –∫–∞–∂–¥–æ–º—É –ª–æ—Ç—É.

#### –¢—Ä–∏–≥–≥–µ—Ä –≤—Ä–µ–º–µ–Ω–∏

```javascript
function setupWeeklyTrigger() {
  // –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
  const triggers = ScriptApp.getProjectTriggers();
  triggers.forEach(trigger => {
    if (trigger.getHandlerFunction() === 'finishAuction') {
      ScriptApp.deleteTrigger(trigger);
    }
  });
  
  // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π
  ScriptApp.newTrigger('finishAuction')
    .timeBased()
    .everyWeeks(1)
    .onWeekDay(ScriptApp.WeekDay.SATURDAY)
    .atHour(21)
    .nearMinute(0)
    .create();
}
```

#### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è

```javascript
function determineWinner(postId) {
  const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName('–°—Ç–∞–≤–∫–∏');
  const data = sheet.getDataRange().getValues();
  
  // –§–∏–ª—å—Ç—Ä: —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ –ø–æ –¥–∞–Ω–Ω–æ–º—É –ª–æ—Ç—É
  const bids = data.filter(row => 
    row[2] === postId && row[7] === 'valid'
  );
  
  if (bids.length === 0) return null;
  
  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞
  const maxBid = Math.max(...bids.map(row => row[4]));
  
  // –í—Å–µ —Å—Ç–∞–≤–∫–∏ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º–æ–π
  const maxBids = bids.filter(row => row[4] === maxBid);
  
  // –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Äî –ø–µ—Ä–≤—ã–π –ø–æ timestamp (—á–µ—Å—Ç–Ω–æ—Å—Ç—å)
  maxBids.sort((a, b) => new Date(a[5]) - new Date(b[5]));
  
  return {
    user_id: maxBids[0][3],
    bid: maxBids[0][4],
    timestamp: maxBids[0][5],
    comment_id: maxBids[0][6]
  };
}
```

#### –ê–ª–≥–æ—Ä–∏—Ç–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

```javascript
function finishAuction() {
  const lock = LockService.getScriptLock();
  lock.waitLock(30000); // –ñ–¥—ë–º –¥–æ 30 —Å–µ–∫
  
  try {
    // 1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ª–æ—Ç—ã
    const lots = getActiveLots();
    
    // 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –ø–æ –∫–∞–∂–¥–æ–º—É
    const winners = [];
    lots.forEach(lot => {
      const winner = determineWinner(lot.post_id);
      if (winner) {
        winners.push({
          post_id: lot.post_id,
          lot_name: lot.name,
          user_id: winner.user_id,
          final_bid: winner.bid
        });
      }
    });
    
    // 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ª–∏—Å—Ç "–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏"
    saveWinners(winners);
    
    // 4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º (–æ—á–µ—Ä–µ–¥—å VK)
    const vkQueue = new VKApiQueue();
    winners.forEach(winner => {
      vkQueue.add('messages.send', {
        user_id: winner.user_id,
        message: `üèÜ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –ª–æ—Ç!\n\n` +
          `${winner.lot_name}\n` +
          `–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞: ${winner.final_bid}‚ÇΩ\n\n` +
          `–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –Ω–∞–ø–∏—à–∏—Ç–µ "–ê–£–ö–¶–ò–û–ù" –≤ —ç—Ç–æ—Ç —á–∞—Ç.`,
        random_id: Date.now()
      });
    });
    vkQueue.process();
    
    // 5. –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–¥ –ø–æ—Å—Ç–∞–º–∏
    winners.forEach(winner => {
      const userName = getUserName(winner.user_id);
      vkQueue.add('wall.createComment', {
        owner_id: GROUP_ID,
        post_id: winner.post_id.split('_')[1],
        message: `üèÜ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: @id${winner.user_id} (${userName}), ` +
          `—Å—Ç–∞–≤–∫–∞ ${winner.final_bid}‚ÇΩ.\n\n` +
          `–ù–∞–ø–∏—à–∏—Ç–µ "–ê–£–ö–¶–ò–û–ù" –≤ –õ–° –≥—Ä—É–ø–ø—ã –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.`,
        from_group: 1
      });
    });
    vkQueue.process();
    
    // 6. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç –∞–¥–º–∏–Ω—É
    sendAdminReport(winners);
    
    // 7. –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ª–æ—Ç—ã
    deactivateLots(lots);
    
  } finally {
    lock.releaseLock();
  }
}
```

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –û–±—Ä–∞–±–æ—Ç–∫–∞ 15 –ª–æ—Ç–æ–≤: ~1-2 –º–∏–Ω—É—Ç—ã
- 15 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–±–µ–¥–∏—Ç–µ–ª—è–º: ~6 —Å–µ–∫—É–Ω–¥ (350ms √ó 15)
- 15 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–¥ –ø–æ—Å—Ç–∞–º–∏: ~6 —Å–µ–∫—É–Ω–¥
- –û–±—â–µ–µ –≤—Ä–µ–º—è: ~2-3 –º–∏–Ω—É—Ç—ã

---

### 4.5 –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã "–ê–£–ö–¶–ò–û–ù" –≤ –õ–°

**ID:** FR-005  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**Event:** `message_new`  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ö–æ–≥–¥–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –ø–∏—à–µ—Ç "–ê–£–ö–¶–ò–û–ù" –≤ –õ–° –≥—Ä—É–ø–ø—ã, –±–æ—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–≤–æ–¥–∫—É —Å —Ä–∞—Å—á—ë—Ç–æ–º –¥–æ—Å—Ç–∞–≤–∫–∏.

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ doPost

```javascript
function doPost(e) {
  const data = JSON.parse(e.postData.contents);
  
  if (data.type === 'message_new') {
    const text = data.object.message.text.trim().toUpperCase();
    const userId = data.object.message.from_id;
    
    if (text === '–ê–£–ö–¶–ò–û–ù') {
      processAuctionCommand(userId);
    }
  }
  
  return ContentService.createTextOutput('ok');
}
```

#### –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–¥–∫–∏

```javascript
function processAuctionCommand(userId) {
  // 1. –ù–∞–π—Ç–∏ –≤—Å–µ –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã–µ –ª–æ—Ç—ã
  const winners = getUserWinningLots(userId);
  
  if (winners.length === 0) {
    sendVKMessage(userId, '–£ –≤–∞—Å –Ω–µ—Ç –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã—Ö –ª–æ—Ç–æ–≤ –≤ —Ç–µ–∫—É—â–µ–º –∞—É–∫—Ü–∏–æ–Ω–µ.');
    return;
  }
  
  // 2. –ü–æ–¥—Å—á—ë—Ç —Å—É–º–º—ã
  const lotsTotal = winners.reduce((sum, lot) => sum + lot.final_bid, 0);
  const lotCount = winners.length;
  
  // 3. –†–∞—Å—á—ë—Ç –¥–æ—Å—Ç–∞–≤–∫–∏
  const delivery = calculateDelivery(lotCount);
  const total = lotsTotal + delivery;
  
  // 4. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞
  const lotsList = winners.map(lot => 
    `‚Ä¢ ${lot.lot_name} ‚Äî ${lot.final_bid}‚ÇΩ`
  ).join('\n');
  
  // 5. –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  const paymentPhone = getConfigValue('payment_phone');
  const paymentBank = getConfigValue('payment_bank');
  
  // 6. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
  const message = `–î–æ–±—Ä—ã–π –¥–µ–Ω—å!\n\n` +
    `–í–∞—à–∏ –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã–µ –ª–æ—Ç—ã:\n${lotsList}\n\n` +
    `–°—É–º–º–∞ –∑–∞ –ª–æ—Ç—ã: ${lotsTotal}‚ÇΩ\n` +
    `–î–æ—Å—Ç–∞–≤–∫–∞ (${lotCount} —Ñ–∏–≥—É—Ä–∫–∏): ${delivery}‚ÇΩ\n` +
    `–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï: ${total}‚ÇΩ\n\n` +
    `–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏—à–ª–∏—Ç–µ:\n` +
    `1. –§–ò–û –ø–æ–ª–Ω–æ—Å—Ç—å—é\n` +
    `2. –ì–æ—Ä–æ–¥ –∏ –∞–¥—Ä–µ—Å (–∏–ª–∏ –°–î–≠–ö/–ü–æ—á—Ç–∞)\n` +
    `3. –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞\n` +
    `4. –°–∫—Ä–∏–Ω—à–æ—Ç –æ–ø–ª–∞—Ç—ã –Ω–∞ –Ω–æ–º–µ—Ä: ${paymentPhone} (${paymentBank})\n\n` +
    `–ü.–°. –ú–æ–∂–µ—Ç–µ –∫–æ–ø–∏—Ç—å —Ñ–∏–≥—É—Ä–∫–∏! –ê—É–∫—Ü–∏–æ–Ω –∫–∞–∂–¥—É—é —Å—É–±–±–æ—Ç—É.\n` +
    `–ù–∞–ø–∏—à–∏—Ç–µ "–ö–û–ü–ò–¢–¨", –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –Ω–∞–∫–æ–ø–∏—Ç—å –±–æ–ª—å—à–µ.`;
  
  sendVKMessage(userId, message);
  
  // 7. –ü–æ–º–µ—Ç–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ
  markSummarySent(userId);
}

function calculateDelivery(lotCount) {
  if (lotCount >= 1 && lotCount <= 3) return 450;
  if (lotCount >= 4 && lotCount <= 6) return 550;
  if (lotCount >= 7) return 650;
  return 0;
}
```

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã: < 2 —Å–µ–∫—É–Ω–¥—ã
- –û—Ç–≤–µ—Ç VK: < 2 —Å–µ–∫—É–Ω–¥—ã (–≥–∞—Ä–∞–Ω—Ç–∏—è)

---

### 4.6 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Google Sheets

**ID:** FR-006  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**Trigger:** onChange (–ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —è—á–µ–µ–∫)  
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ê–¥–º–∏–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —è—á–µ–µ–∫ —Ç–∞–±–ª–∏—Ü—ã.

#### –õ–∏—Å—Ç "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" (key-value)

```
| parameter_name          | value                 | description                    |
|-------------------------|-----------------------|--------------------------------|
| auction_marker          | #–∞—É–∫—Ü–∏–æ–Ω              | –ú–∞—Ä–∫–µ—Ä –¥–ª—è –∞–≤—Ç–æ–ø–æ–∏—Å–∫–∞ –ø–æ—Å—Ç–æ–≤   |
| auction_end_time        | 21:00                 | –í—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è               |
| bid_step                | 50                    | –®–∞–≥ —Å—Ç–∞–≤–∫–∏ –≤ —Ä—É–±–ª—è—Ö            |
| bid_step_enabled        | true                  | –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞–≥–∞ (true/false)     |
| min_bid                 | 100                   | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞             |
| only_subscribers        | false                 | –¢–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ (true/false) |
| admin_user_ids          | 12345,67890           | ID –∞–¥–º–∏–Ω–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)     |
| payment_phone           | +79110702193          | –ù–æ–º–µ—Ä –¥–ª—è –æ–ø–ª–∞—Ç—ã               |
| payment_bank            | –°–ë–ï–†                  | –ë–∞–Ω–∫                           |
| group_id                | -202389657            | ID —Å–æ–æ–±—â–µ—Å—Ç–≤–∞                  |
| vk_api_token            | [ENCRYPTED]           | –¢–æ–∫–µ–Ω VK (–≤ PropertiesService) |
```

#### onChange Trigger (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```javascript
function onEdit(e) {
  const sheet = e.source.getActiveSheet();
  const range = e.range;
  
  // –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–∏ –ª–∏—Å—Ç "–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏"
  if (sheet.getName() === '–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏') {
    const column = range.getColumn();
    
    // –ö–æ–ª–æ–Ω–∫–∞ "winner" (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–æ–ª–±–µ—Ü B)
    if (column === 2) {
      const row = range.getRow();
      const newWinner = range.getValue();
      const postId = sheet.getRange(row, 3).getValue(); // post_id
      
      // –£–≤–µ–¥–æ–º–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
      notifyNewWinner(postId, newWinner);
    }
  }
}
```

---

## 5. –°–¢–†–£–ö–¢–£–†–ê GOOGLE SHEETS

### 5.1 –õ–∏—Å—Ç "–ö–æ–Ω—Ñ–∏–≥"

| A: auction_date | B: post_id | C: lot_num | D: lot_name | E: start_price | F: end_time | G: status |
|-----------------|------------|------------|-------------|----------------|-------------|-----------|
| 2026-02-08 | -202389657_48965 | 1691 | –§–∏–≥—É—Ä–∫–∞ Space Marine | 300 | 21:00 | active |

**–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞:** `post_id` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)

---

### 5.2 –õ–∏—Å—Ç "–°—Ç–∞–≤–∫–∏"

| A: id | B: auction_date | C: post_id | D: user_id | E: bid | F: timestamp | G: comment_id | H: status |
|-------|-----------------|------------|------------|--------|--------------|---------------|-----------|
| 1 | 2026-02-08 | -202389657_48965 | 12345 | 500 | 2026-02-08 14:30:15 | 777 | valid |
| 2 | 2026-02-08 | -202389657_48965 | 67890 | 550 | 2026-02-08 14:35:20 | 778 | valid |

**–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞:** `post_id` + `bid DESC` (–¥–ª—è getCurrentMaxBid)

---

### 5.3 –õ–∏—Å—Ç "–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏"

| A: auction_date | B: user_id | C: post_id | D: lot_name | E: final_bid | F: summary_sent | G: paid | H: delivery |
|-----------------|------------|------------|-------------|--------------|-----------------|---------|-------------|
| 2026-02-08 | 67890 | -202389657_48965 | –§–∏–≥—É—Ä–∫–∞ Space Marine | 550 | FALSE | FALSE | 450 |

---

### 5.4 –õ–∏—Å—Ç "–û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"

| A: id | B: user_id | C: post_id | D: old_bid | E: new_bid | F: lot_name | G: queued_at | H: status |
|-------|------------|------------|------------|------------|-------------|--------------|-----------|
| 1 | 12345 | -202389657_48965 | 500 | 550 | –§–∏–≥—É—Ä–∫–∞ | 2026-02-08 14:30 | pending |

**–°—Ç–∞—Ç—É—Å—ã:** `pending`, `sent`, `failed`

---

### 5.5 –õ–∏—Å—Ç "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"

–°–º. —Ä–∞–∑–¥–µ–ª 4.6.

---

## 6. VK API –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

### 6.1 Callback API Events

| Event Type | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
|------------|------------|-----------------|
| `confirmation` | –í–æ–∑–≤—Ä–∞—Ç confirmation code | < 100ms |
| `wall_post_new` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ—Ç–∞ | < 1.5 —Å–µ–∫ |
| `wall_reply_new` | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞–≤–∫–∏ | < 2 —Å–µ–∫ |
| `wall_reply_edit` | –ü–µ—Ä–µ—Å—á—ë—Ç —Å—Ç–∞–≤–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | < 2 —Å–µ–∫ |
| `wall_reply_delete` | –ü–æ–º–µ—Ç–∫–∞ deleted (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | < 2 —Å–µ–∫ |
| `message_new` | –ö–æ–º–∞–Ω–¥–∞ "–ê–£–ö–¶–ò–û–ù" | < 2 —Å–µ–∫ |

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –æ—Ç–≤–µ—Ç–∏—Ç—å `"ok"` –∑–∞ < 5 —Å–µ–∫—É–Ω–¥ (–Ω–∞—à–∞ –≥–∞—Ä–∞–Ω—Ç–∏—è: < 2 —Å–µ–∫).

---

### 6.2 VK API Methods

| –ú–µ—Ç–æ–¥ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ß–∞—Å—Ç–æ—Ç–∞ | Rate Limit |
|-------|------------|---------|------------|
| `messages.send` | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —Å–≤–æ–¥–∫–∏ | ~100/–∞—É–∫—Ü–∏–æ–Ω | 3/—Å–µ–∫ |
| `wall.createComment` | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–º | 15/–∞—É–∫—Ü–∏–æ–Ω | 3/—Å–µ–∫ |
| `groups.isMember` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | –ü–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é | 3/—Å–µ–∫ |
| `users.get` | –§–ò–û –¥–ª—è –æ—Ç—á—ë—Ç–∞ | 15/–∞—É–∫—Ü–∏–æ–Ω | 3/—Å–µ–∫ |

**–ó–∞—â–∏—Ç–∞ –æ—Ç 429 (Too Many Requests):**
- –û—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 350ms
- Retry √ó 3 –ø—Ä–∏ –æ—à–∏–±–∫–µ 429
- Exponential backoff: 1 —Å–µ–∫, 2 —Å–µ–∫, 4 —Å–µ–∫

---

## 7. –ù–ï–§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 7.1 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|---------|------------|-------------|
| **–û—Ç–≤–µ—Ç VK Callback** | < 2 —Å–µ–∫—É–Ω–¥—ã | VK –ª–∏–º–∏—Ç 5 —Å–µ–∫, –∑–∞–ø–∞—Å √ó2.5 |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞–≤–∫–∏** | < 1.5 —Å–µ–∫—É–Ω–¥—ã | Lock + –∑–∞–ø–∏—Å—å –≤ Sheets |
| **–ó–∞–¥–µ—Ä–∂–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** | 1-3 –º–∏–Ω—É—Ç—ã | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å, debounce |
| **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–∞** | < 5 –º–∏–Ω—É—Ç –Ω–∞ 15 –ª–æ—Ç–æ–≤ | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| **VK API Rate Limit** | ‚â§ 2.85 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫—É–Ω–¥—É | VK –ª–∏–º–∏—Ç 3/—Å–µ–∫, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∑–∞–ø–∞—Å |
| **Concurrent —Å—Ç–∞–≤–æ–∫** | –î–æ 30 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ | GAS –ª–∏–º–∏—Ç 30 doPost concurrent |

---

### 7.2 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–§–ó-152)

**–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è:**
- ‚úÖ VK User ID (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä)
- ‚úÖ –°—É–º–º—ã —Å—Ç–∞–≤–æ–∫
- ‚úÖ Timestamp —Å–æ–±—ã—Ç–∏–π
- ‚úÖ Comment ID (–¥–ª—è —Å–≤—è–∑–∏)
- ‚ùå **–ù–ï —Ö—Ä–∞–Ω–∏—Ç—Å—è:** –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω—ã, email, –∞–¥—Ä–µ—Å–∞

**–§–ò–û –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏** —á–µ—Ä–µ–∑ VK API —Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤ –∏ —Å—Ä–∞–∑—É –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è.

**–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏** (–¥–ª—è –≥—Ä—É–ø–ø—ã):
```
–ü—Ä–∏ —É—á–∞—Å—Ç–∏–∏ –≤ –∞—É–∫—Ü–∏–æ–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è: —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π ID VK, —Å—É–º–º—ã —Å—Ç–∞–≤–æ–∫, timestamp.
–ù–ï —Ö—Ä–∞–Ω–∏–º: –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω—ã, email, –∞–¥—Ä–µ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö.
–û—Å–Ω–æ–≤–∞–Ω–∏–µ: –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞ (—á. 5 —Å—Ç. 6 –§–ó-152).
–£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: –Ω–∞–ø–∏—Å–∞—Ç—å "–£–î–ê–õ–ò–¢–¨ –ú–û–ò –î–ê–ù–ù–´–ï" –≤ –õ–° (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –¥–Ω–µ–π).
```

---

### 7.3 –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å

**–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:**
- ‚úÖ Retry √ó 3 –¥–ª—è VK API (429, network errors)
- ‚úÖ Lock timeout 3 —Å–µ–∫ (—á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç—å 5 —Å–µ–∫ VK)
- ‚úÖ –í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—Ç "ok" VK (–¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –≤ Logger (–¥–æ—Å—Ç—É–ø–Ω–æ 28 –¥–Ω–µ–π)
- ‚úÖ –û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Å–±–æ–µ)

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- ‚úÖ –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ (–∞–∫—Ç–∏–≤–Ω—ã –ª–∏)
- ‚úÖ –ê–ª–µ—Ä—Ç –∞–¥–º–∏–Ω—É –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö (email)
- ‚úÖ –õ–∏—Å—Ç "–õ–æ–≥–∏" –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## 8. EDGE CASES

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ü–æ–≤–µ–¥–µ–Ω–∏–µ | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|----------|-----------|-------------|
| **–î–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞** | –ü–æ–±–µ–∂–¥–∞–µ—Ç –ø–µ—Ä–≤—ã–π (–ø–æ timestamp) | –ß–µ—Å—Ç–Ω–æ—Å—Ç—å, FIFO |
| **–°—Ç–∞–≤–∫–∞ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è** | –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è | –ü—Ä–æ–≤–µ—Ä–∫–∞ `timestamp < end_time` |
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–∏–ª –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π** | –°—Ç–∞–≤–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –±–∞–∑–µ (status = valid) | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω VK —Å–æ–±—ã—Ç–∏–µ–º |
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –õ–°** | –û—à–∏–±–∫–∞ 901 –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º | –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ |
| **VK API 429 (Too Many Requests)** | Retry √ó 3 —á–µ—Ä–µ–∑ 1, 2, 4 —Å–µ–∫ | Exponential backoff |
| **Lock timeout > 3 —Å–µ–∫** | –°—Ç–∞–≤–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è, –ª–æ–≥ | –ß—Ç–æ–±—ã –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç—å 5 —Å–µ–∫ VK |
| **doPost timeout > 30 —Å–µ–∫** | GAS —É–±–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, VK –ø–æ–≤—Ç–æ—Ä—è–µ—Ç | –ö—Ä–∏—Ç–∏—á–Ω–æ ‚Äî –Ω–µ –¥–æ–ø—É—Å–∫–∞—Ç—å |
| **–ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Å—Ç–æ–≤ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º –ª–æ—Ç–∞** | –ü–µ—Ä–≤—ã–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏ | –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ post_id |
| **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π "550 —Ä—É–±–ª–µ–π –Ω–∞ –¥—Ä—É–≥–æ–π –ª–æ—Ç"** | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ —Å—Ç–∞–≤–∫–∞ 550 | –ü–∞—Ä—Å–∏–Ω–≥ –ø–æ —á–∏—Å–ª—É, –Ω–µ –ø–æ —Å–º—ã—Å–ª—É |
| **–ê–¥–º–∏–Ω –º–µ–Ω—è–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ** | onChange —Ç—Ä–∏–≥–≥–µ—Ä —É–≤–µ–¥–æ–º–ª—è–µ—Ç –Ω–æ–≤–æ–≥–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | –ì–∏–±–∫–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è |

---

## 9. –†–ê–ó–í–Å–†–¢–´–í–ê–ù–ò–ï

### 9.1 –ß–µ–∫–ª–∏—Å—Ç

**–®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Google –¢–∞–±–ª–∏—Ü—ã**
1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é Google –¢–∞–±–ª–∏—Ü—É
2. –°–æ–∑–¥–∞—Ç—å –ª–∏—Å—Ç—ã: "–ö–æ–Ω—Ñ–∏–≥", "–°—Ç–∞–≤–∫–∏", "–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏", "–û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π", "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å—Ç–æ–ª–±—Ü–æ–≤ (—Å–º. —Ä–∞–∑–¥–µ–ª 5)
4. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
5. –î–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫–ª–∏–µ–Ω—Ç—É (–†–µ–¥–∞–∫—Ç–æ—Ä)

**–®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ Apps Script –ø—Ä–æ–µ–∫—Ç–∞**
1. –í —Ç–∞–±–ª–∏—Ü–µ: –†–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Üí Apps Script
2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ (–º–æ–¥—É–ª–∏: Config, PostTracker, BidProcessor, Notifier, WinnerManager, ReportGenerator)
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SHEET_ID –≤ PropertiesService
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å VK_TOKEN –≤ PropertiesService (–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å GROUP_ID –≤ PropertiesService

**–®–∞–≥ 3: Deploy Web App**
1. Deploy ‚Üí New deployment
2. –¢–∏–ø: Web app
3. Execute as: Me
4. Who has access: Anyone
5. Deploy ‚Üí –ø–æ–ª—É—á–∏—Ç—å URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://script.google.com/macros/s/.../exec`)

**–®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VK Callback API**
1. –ì—Ä—É–ø–ø–∞ ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí –†–∞–±–æ—Ç–∞ —Å API ‚Üí Callback API
2. –£–∫–∞–∑–∞—Ç—å Server URL (–∏–∑ —à–∞–≥–∞ 3)
3. –£–∫–∞–∑–∞—Ç—å Secret key (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PropertiesService)
4. –í–∫–ª—é—á–∏—Ç—å —Å–æ–±—ã—Ç–∏—è: `wall_post_new`, `wall_reply_new`, `message_new`
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (confirmation code –≤ –∫–æ–¥–µ)

**–®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤**
1. Trigger 1: `processNotificationQueue()` ‚Äî Time-based, Every minute
2. Trigger 2: `finishAuction()` ‚Äî Time-based, Every week Saturday 21:00
3. Trigger 3 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): `onEdit()` ‚Äî On change

**–®–∞–≥ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
1. –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ—Å—Ç —Å `#–∞—É–∫—Ü–∏–æ–Ω`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø–æ—Å—Ç –¥–æ–±–∞–≤–∏–ª—Å—è –≤ "–ö–æ–Ω—Ñ–∏–≥"
3. –°–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç–∞–≤–∫—É
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —Å—Ç–∞–≤–∫–∞ –≤ "–°—Ç–∞–≤–∫–∏", —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ (—á–µ—Ä–µ–∑ 1-3 –º–∏–Ω)
5. –ó–∞–ø—É—Å—Ç–∏—Ç—å `finishAuction()` –≤—Ä—É—á–Ω—É—é
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω

**–®–∞–≥ 7: –ü–µ—Ä–≤—ã–π –±–æ–µ–≤–æ–π –∞—É–∫—Ü–∏–æ–Ω**
1. –ö–ª–∏–µ–Ω—Ç –ø—É–±–ª–∏–∫—É–µ—Ç 15 –ø–æ—Å—Ç–æ–≤ —Å `#–∞—É–∫—Ü–∏–æ–Ω`
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ real-time (—Ç–∞–±–ª–∏—Ü–∞ "–°—Ç–∞–≤–∫–∏")
3. –§–∏–∫—Å–∞—Ü–∏—è –æ—à–∏–±–æ–∫ (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. 21:00 ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π

---

### 9.2 –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] SHEET_ID —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ PropertiesService
- [ ] VK_TOKEN —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ PropertiesService
- [ ] GROUP_ID —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ PropertiesService
- [ ] Callback API –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
- [ ] –¢—Ä–∏–≥–≥–µ—Ä `processNotificationQueue()` –∞–∫—Ç–∏–≤–µ–Ω
- [ ] –¢—Ä–∏–≥–≥–µ—Ä `finishAuction()` –∞–∫—Ç–∏–≤–µ–Ω (—Å—É–±–±–æ—Ç–∞ 21:00)
- [ ] –õ–∏—Å—Ç "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" –∑–∞–ø–æ–ª–Ω–µ–Ω (–Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –±–∞–Ω–∫, –º–∞—Ä–∫–µ—Ä)
- [ ] –ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ—Å—Ç, —Å—Ç–∞–≤–∫–∞, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)
- [ ] –ö–ª–∏–µ–Ω—Ç –æ–±—É—á–µ–Ω —Ä–∞–±–æ—Ç–µ —Å —Ç–∞–±–ª–∏—Ü–µ–π (–≤–∏–¥–µ–æ –∏–ª–∏ —Å–æ–∑–≤–æ–Ω)
- [ ] –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–µ—Ä–µ–¥–∞–Ω–∞ –∫–ª–∏–µ–Ω—Ç—É (PDF –∏–ª–∏ Google Docs)

---

## 10. –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–Å–ú–ö–ò

| ID | –¢–µ—Å—Ç | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç | –ú–µ—Ç—Ä–∏–∫–∞ |
|----|------|---------------------|---------|
| **T-001** | –ü–æ—Å—Ç —Å `#–∞—É–∫—Ü–∏–æ–Ω` –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω | –î–æ–±–∞–≤–ª–µ–Ω –≤ "–ö–æ–Ω—Ñ–∏–≥" –∑–∞ < 2 —Å–µ–∫ | ‚úÖ –í—Ä–µ–º—è < 2 —Å–µ–∫ |
| **T-002** | –°—Ç–∞–≤–∫–∞ "500" –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | –ó–∞–ø–∏—Å–∞–Ω–∞ –≤ "–°—Ç–∞–≤–∫–∏" –∑–∞ < 2 —Å–µ–∫ | ‚úÖ –í—Ä–µ–º—è < 2 —Å–µ–∫ |
| **T-003** | –°—Ç–∞–≤–∫–∞ 400 < —Ç–µ–∫—É—â–µ–π 500 | –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è) | ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è |
| **T-004** | –î–≤–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ 500 –∏ 550 | –û–±–µ –∑–∞–ø–∏—Å–∞–Ω—ã, –ø–æ–±–µ–¥–∏—Ç–µ–ª—å = 550 | ‚úÖ Lock —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **T-005** | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–±–∏—Ç–æ–≥–æ | –õ–° –ø—Ä–∏—à–ª–æ –∑–∞ < 3 –º–∏–Ω—É—Ç—ã | ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å |
| **T-006** | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤ 21:00 | 15 –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –∑–∞ < 5 –º–∏–Ω | ‚úÖ –í—Ä–µ–º—è < 5 –º–∏–Ω |
| **T-007** | –ö–æ–º–∞–Ω–¥–∞ "–ê–£–ö–¶–ò–û–ù" –≤ –õ–° | –°–≤–æ–¥–∫–∞ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏ –∑–∞ < 3 —Å–µ–∫ | ‚úÖ –†–∞—Å—á—ë—Ç –¥–æ—Å—Ç–∞–≤–∫–∏ |
| **T-008** | –ê–¥–º–∏–Ω –º–µ–Ω—è–µ—Ç winner –≤ —Ç–∞–±–ª–∏—Ü–µ | –ù–æ–≤–æ–º—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –õ–° (–µ—Å–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä) | ‚úÖ onChange —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **T-009** | 30 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ç–∞–≤–æ–∫ | –í—Å–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ | ‚úÖ Concurrent < 30 |
| **T-010** | VK –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç (timeout) | Retry √ó 3, –∑–∞—Ç–µ–º –ª–æ–≥ –æ—à–∏–±–∫–∏ | ‚úÖ –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å |

---

## 11. –°–†–û–ö–ò –ò –û–¶–ï–ù–ö–ê

### 11.1 –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏

| –≠—Ç–∞–ø | –ó–∞–¥–∞—á–∏ | –ß–∞—Å—ã |
|------|--------|------|
| **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã** | –¢–∞–±–ª–∏—Ü–∞, Apps Script, PropertiesService | 2 |
| **doPost + Callback API** | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π, confirmation | 3 |
| **PostTracker** | –ê–≤—Ç–æ–ø–æ–∏—Å–∫ –ø–æ—Å—Ç–æ–≤, –ø–∞—Ä—Å–∏–Ω–≥ | 2 |
| **BidProcessor** | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞–≤–æ–∫, Lock, –≤–∞–ª–∏–¥–∞—Ü–∏—è | 4 |
| **NotificationQueue** | –û—á–µ—Ä–µ–¥—å, debounce, rate limiting | 3 |
| **WinnerManager** | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π, —Ç—Ä–∏–≥–≥–µ—Ä | 3 |
| **ReportGenerator** | –ö–æ–º–∞–Ω–¥–∞ –ê–£–ö–¶–ò–û–ù, —Ä–∞—Å—á—ë—Ç –¥–æ—Å—Ç–∞–≤–∫–∏ | 2 |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | Unit-—Ç–µ—Å—Ç—ã, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã | 4 |
| **–û—Ç–ª–∞–¥–∫–∞ –Ω–∞ –±–æ–µ–≤–æ–º –∞—É–∫—Ü–∏–æ–Ω–µ** | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤ | 4 |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è + –æ–±—É—á–µ–Ω–∏–µ** | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –≤–∏–¥–µ–æ, –ø–µ—Ä–µ–¥–∞—á–∞ | 3 |
| **–ò–¢–û–ì–û** | | **30 —á–∞—Å–æ–≤** |

### 11.2 –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ —Å—Ä–æ–∫–∏

- **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:** 4-5 –¥–Ω–µ–π —á–∏—Å—Ç–æ–π —Ä–∞–±–æ—Ç—ã (30 —á / 6-8 —á/–¥–µ–Ω—å)
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** 1-2 –¥–Ω—è (–æ–∂–∏–¥–∞–Ω–∏–µ —Å—É–±–±–æ—Ç—ã –¥–ª—è –±–æ–µ–≤–æ–≥–æ –∞—É–∫—Ü–∏–æ–Ω–∞)
- **–î–æ—Ä–∞–±–æ—Ç–∫–∏:** 1-2 –¥–Ω—è (–ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º)
- **–û–±—É—á–µ–Ω–∏–µ:** 1 –¥–µ–Ω—å

**–û–±—â–∏–π —Å—Ä–æ–∫:** 7-10 –¥–Ω–µ–π –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö

---

## 12. –°–¢–û–ò–ú–û–°–¢–¨ –°–û–î–ï–†–ñ–ê–ù–ò–Ø

| –†–µ—Å—É—Ä—Å | –õ–∏–º–∏—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ tier | –ù–∞—à–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------|------------------------|---------------|-----------|
| **Google Apps Script** | 20,000 URL Fetch/–¥–µ–Ω—å, 90 –º–∏–Ω runtime/–¥–µ–Ω—å | ~300 URL Fetch/–¥–µ–Ω—å, ~5 –º–∏–Ω runtime/–¥–µ–Ω—å | **0‚ÇΩ/–º–µ—Å** |
| **Google Sheets** | 15 –ì–ë | ~1 –ú–ë/–≥–æ–¥ | **0‚ÇΩ/–º–µ—Å** |
| **VK API** | –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (–±–µ—Å–ø–ª–∞—Ç–Ω–æ) | ~300 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å | **0‚ÇΩ/–º–µ—Å** |
| **–ò–¢–û–ì–û** | ‚Äî | ‚Äî | **0‚ÇΩ/–º–µ—Å** |

**–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 3 –≥–æ–¥–∞:** 0‚ÇΩ (–≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ—Å–ø–ª–∞—Ç–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏)

---

## 13. –†–ò–°–ö–ò –ò –ú–ò–¢–ò–ì–ê–¶–ò–Ø

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| **VK –∏–∑–º–µ–Ω–∏—Ç Callback API** | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ changelog VK, –±—ã—Å—Ç—Ä–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è (1-2 —á–∞—Å–∞) |
| **Google —Å–¥–µ–ª–∞–µ—Ç GAS –ø–ª–∞—Ç–Ω—ã–º** | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Vercel/Railway (—Å—Ç–æ–∏–º–æ—Å—Ç—å ~$5/–º–µ—Å) |
| **–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ GAS** | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞, –±–∞—Ç—á–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤ |
| **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–æ—Ç–∞ –í–ö** | –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ | Compliance —Å ToS VK, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ API |
| **Race conditions (Lock fails)** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | Timeout Lock = 3 —Å–µ–∫, retry –ª–æ–≥–∏–∫–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **–°–∫–æ–ø —Ä–∞—Å–ø–æ–ª–∑–∞–µ—Ç—Å—è (feature creep)** | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | –ß—ë—Ç–∫–æ–µ –¢–ó, change requests —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ MVP |

---

## 14. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (–≤–Ω–µ –±–∞–∑–æ–≤–æ–≥–æ scope)

–°–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ **–Ω–µ –≤—Ö–æ–¥—è—Ç** –≤ –±–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç, –Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø–ª–∞—Ç—É:

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ |
|---------|----------|-----------|----------------|
| **–ê–≤—Ç–æ–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** | –ß–µ—Ä–µ–∑ 3 –¥–Ω—è –ø–æ—Å–ª–µ –∞—É–∫—Ü–∏–æ–Ω–∞ –±–æ—Ç –ø–∏—à–µ—Ç –Ω–µ –æ—Ñ–æ—Ä–º–∏–≤—à–∏–º –∑–∞–∫–∞–∑ | –°—Ä–µ–¥–Ω—è—è | +4 —á–∞—Å–∞ |
| **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** | –õ–∏—Å—Ç —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏: –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ª–æ—Ç—ã, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫, –∫–æ–Ω–≤–µ—Ä—Å–∏—è | –°—Ä–µ–¥–Ω—è—è | +6 —á–∞—Å–æ–≤ |
| **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã** | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≥—Ä—É–ø–ø –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ | –í—ã—Å–æ–∫–∞—è | +10 —á–∞—Å–æ–≤ |
| **CRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** | –í—ã–≥—Ä—É–∑–∫–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –≤ –ë–∏—Ç—Ä–∏–∫—Å24/amoCRM | –í—ã—Å–æ–∫–∞—è | +15 —á–∞—Å–æ–≤ |
| **–í–µ–±-–∞–¥–º–∏–Ω–∫–∞** | –ö—Ä–∞—Å–∏–≤–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ Sheets | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | +40 —á–∞—Å–æ–≤ |
| **–≠–∫–≤–∞–π—Ä–∏–Ω–≥** | –û–Ω–ª–∞–π–Ω-–æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –ÆKassa/Robokassa | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | +30 —á–∞—Å–æ–≤ |

---

## –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ê: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ (–º–æ–¥—É–ª–∏)

```
project/
‚îú‚îÄ‚îÄ main.gs              # doPost(), entry point
‚îú‚îÄ‚îÄ config.gs            # PropertiesService, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ postTracker.gs       # wall_post_new –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îú‚îÄ‚îÄ bidProcessor.gs      # wall_reply_new –æ–±—Ä–∞–±–æ—Ç–∫–∞ + Lock
‚îú‚îÄ‚îÄ notificationQueue.gs # –¢—Ä–∏–≥–≥–µ—Ä –æ—á–µ—Ä–µ–¥–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îú‚îÄ‚îÄ winnerManager.gs     # finishAuction(), –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ reportGenerator.gs   # –ö–æ–º–∞–Ω–¥–∞ –ê–£–ö–¶–ò–û–ù, —Ä–∞—Å—á—ë—Ç –¥–æ—Å—Ç–∞–≤–∫–∏
‚îú‚îÄ‚îÄ vkApi.gs             # VKApiQueue, rate limiting, retry
‚îú‚îÄ‚îÄ helpers.gs           # –£—Ç–∏–ª–∏—Ç—ã (–ø–∞—Ä—Å–∏–Ω–≥, –≤–∞–ª–∏–¥–∞—Ü–∏—è)
‚îî‚îÄ‚îÄ triggers.gs          # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ë: –ü—Ä–∏–º–µ—Ä—ã VK —Å–æ–±—ã—Ç–∏–π

**wall_post_new:**
```json
{
  "type": "wall_post_new",
  "object": {
    "id": 48965,
    "from_id": -202389657,
    "owner_id": -202389657,
    "date": 1707206400,
    "text": "#–∞—É–∫—Ü–∏–æ–Ω\n–õ–æ—Ç ‚Ññ1691\n–§–∏–≥—É—Ä–∫–∞ Space Marine\n–°—Ç–∞—Ä—Ç: 300‚ÇΩ",
    "post_type": "post"
  },
  "group_id": 202389657
}
```

**wall_reply_new:**
```json
{
  "type": "wall_reply_new",
  "object": {
    "id": 777,
    "from_id": 12345,
    "date": 1707208800,
    "text": "500",
    "post_owner_id": -202389657,
    "post_id": 48965
  },
  "group_id": 202389657
}
```

---

**–ö–æ–Ω–µ—Ü —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è**

_–í–µ—Ä—Å–∏—è 2.0 –æ—Ç 06.02.2026_  
_–£—á—Ç–µ–Ω—ã: VK Callback timeout 5 —Å–µ–∫, GAS quotas, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, rate limiting_