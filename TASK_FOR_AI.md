### **Задание для ИИ Агента: Реализация и верификация полных циклов симуляции**

**1. Контекст Проекта: "VK Аукционный Бот" на Google Apps Script**

Проект "VK Аукционный Бот" представляет собой автоматизированную систему для проведения аукционов во ВКонтакте. Он работает на базе Google Apps Script (GAS) и использует Google Sheets для хранения всех данных (лоты, ставки, пользователи, заказы, настройки).

**Ключевые функциональные области бота:**
*   **Автоматизация аукциона:** Поиск лотов на стене VK, обработка ставок в комментариях, определение победителей, продление дедлайнов.
*   **Взаимодействие с пользователями:** Уведомления о перебитых ставках, сообщения победителям в ЛС (сводки заказов, реквизиты, запрос данных для доставки), подтверждение получения данных для доставки.
*   **Отчетность:** Отправка администраторам сводных отчетов по победителям.
*   **Мониторинг и диагностика:** Запись системных событий, проверки здоровья системы.
*   **Симулятор:** Инструмент для тестирования всех этапов работы бота без реальных пользователей.

**Файловая структура проекта:**
*   `Code.gs`: Основная логика, обработка Webhook, маршрутизация событий, `onOpen()` для создания меню, функции `handleMessageNew`, `finalizeAuction`.
*   `Sheets.gs`: Взаимодействие с Google Sheets (чтение/запись данных, работа с листами `Лоты`, `Ставки`, `Пользователи`, `Заказы`, `Настройки`, `Статистика`).
*   `Vk.gs`: Обёртка для VK API, включая `callVk()` с ретраями, `sendMessage()`, `getUserName()`.
*   `AuctionSimulator.gs`: Содержит функции для симуляции (создание постов, комментариев).
*   `Monitoring.gs`: Логирование событий в лист "Статистика".
*   `appsscript.json`: Манифест проекта Apps Script.
*   `vk-auction-tech-spec-v2.md`: Техническая спецификация проекта.
*   `CHANGELOG.md`: Журнал изменений.

**2. Цель Задания: Расширение симулятора до полного цикла**

Текущий симулятор (`AuctionSimulator.gs`) способен создавать лоты и имитировать торги. Задание состоит в том, чтобы расширить его функциональность до **полного цикла взаимодействия**, который охватывает как действия бота, так и действия пользователя-победителя. Это позволит всесторонне тестировать систему.

**3. Документация Полных Циклов (Приложение D)**

Детальное описание полных циклов действий бота и победителя, включая ожидаемые изменения в Google Sheets и чек-листы для проверки каждого шага, уже задокументировано в файле `auction/vk-auction-tech-spec-v2.md`, в разделе **"Приложение D: Полные циклы симуляции (с детализацией и чек-листами)"**.

**4. Задача для ИИ Агента**

**Модифицировать файл:** `auction/AuctionSimulator.gs`

**Создать новую функцию:** `runFullCycleSimulation()`

**Описание функции `runFullCycleSimulation()`:**

Эта функция должна будет последовательно выполнять все шаги, описанные в **"Приложении D"** (Полный цикл действий Бота и Полный цикл действий Победителя).

**Ключевые требования к реализации:**

*   **Последовательность и зависимость:** Каждый следующий шаг должен выполняться только после успешного завершения предыдущего.
*   **Самопроверка (верификация):**
    *   После каждого действия (например, вызова `finalizeAuction()`, отправки сообщения ботом, отправки сообщения пользователем) функция должна **читать данные из соответствующих листов Google Sheets** (используя `getSheetData()` из `Sheets.gs`).
    *   Необходимо проверять, что ожидаемые изменения в таблице (согласно чек-листам в Приложении D) действительно произошли.
    *   В случае, если проверка не пройдена (т.е., данные в таблице не соответствуют ожидаемым после действия), симуляция должна **остановиться** и записать подробное сообщение об ошибке в лог (`Monitoring.recordEvent` или `Logger.log`).
*   **Использование существующих функций:** Функция `runFullCycleSimulation()` должна активно использовать уже имеющиеся функции проекта:
    *   Из `AuctionSimulator.gs`: `postCommentAsUser()`, `chooseBidScenario()` (для эмуляции торгов).
    *   Из `Code.gs`: `finalizeAuction()`, `handleMessageNew()` (для имитации входящих сообщений от пользователя к боту).
    *   Из `Vk.gs`: `callVk()` (для отправки сообщений от симулятора), `sendMessage()` (для отправки сообщений от симулятора), `getUsersInfo()` (для получения информации о тестовом пользователе).
    *   Из `Sheets.gs`: `getSheetData()`, `appendRow()`, `updateRow()` (для верификации состояния таблицы).
    *   Из `Monitoring.gs`: `Monitoring.recordEvent()` (для логирования этапов симуляции).
*   **Обработка задержек:** Для имитации реального взаимодействия с VK API и обеспечения времени на асинхронную обработку событий Google Apps Script, необходимо адекватно использовать `Utilities.sleep()` между шагами. Задержки должны быть достаточными для обработки событий.
*   **Тестовые данные:** Симулятор должен использовать заранее определенные тестовые `lot_id` и `user_id` для тестового победителя.
*   **Логирование:** Каждый этап симуляции, а также результаты проверок, должны быть записаны в лист `Статистика` (`Monitoring.recordEvent`) для отладки.

**Ожидаемый результат:**
Функция `runFullCycleSimulation()` будет полностью автономно симулировать и верифицировать весь жизненный цикл аукциона, предоставляя уверенность в корректности работы всех компонентов системы.