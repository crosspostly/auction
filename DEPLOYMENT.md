# Руководство по развертыванию VK Auction Bot

## Быстрый старт

### Шаг 1: Подготовка проекта Google Apps Script

1. Откройте вашу Google Таблицу.
2. Перейдите в **Расширения** → **Apps Script**.
3. Убедитесь, что все файлы (`Code.gs`, `Sheets.gs`, `Vk.gs`, и т.д.) загружены в проект.

### Шаг 2: Настройка доступа к Web App

Для корректной работы VK Callback API ваше веб-приложение должно быть доступно всем:

1. В редакторе Apps Script нажмите **Развернуть** → **Управление развертываниями**.
2. Выберите развертывание с фиксированным ID: `AKfycbzbwSRFDZZeqNC0nYORjjXaPpjl2368dYRDCQtJUgTqqQqQLP1MluqwesupNkC_Gz3p`.
3. Нажмите иконку карандаша ✏️ (Редактировать).
4. Убедитесь, что:
   - **Кто имеет доступ:** "Все" (Anyone).
   - **Запускать от имени:** "Меня" (Me).
5. Выберите **Новая версия** и нажмите **Развернуть**.

### Шаг 3: Развертывание через CLI (Clasp)

Если вы используете `clasp` для разработки, всегда используйте следующую команду для сохранения постоянного URL:

```bash
npx clasp deploy -i AKfycbzbwSRFDZZeqNC0nYORjjXaPpjl2368dYRDCQtJUgTqqQqQLP1MluqwesupNkC_Gz3p -d "Ваше описание версии"
```

### Шаг 4: Настройка Callback API в VK

1. Откройте настройки вашего сообщества ВКонтакте.
2. Перейдите в **Управление** → **Работа с API** → **Callback API**.
3. В поле **Адрес** вставьте URL вашего веб-приложения:
   `https://script.google.com/macros/s/AKfycbzbwSRFDZZeqNC0nYORjjXaPpjl2368dYRDCQtJUgTqqQqQLP1MluqwesupNkC_Gz3p/exec`
4. Нажмите **Подтвердить**. Бот должен автоматически ответить кодом подтверждения.
5. Включите события:
   - ✅ Новые записи на стене (`wall_post_new`)
   - ✅ Комментарии к записям (`wall_reply_new`)
   - ✅ Редактирование комментариев (`wall_reply_edit`)
   - ✅ Удаление комментариев (`wall_reply_delete`)
   - ✅ Входящие сообщения (`message_new`)

---

## Важные настройки (PropertiesService)

Чувствительные данные хранятся в скрытых свойствах скрипта. Настройте их через меню в Google Таблице:
- `VK_TOKEN`: Токен группы.
- `USER_TOKEN`: Токен администратора (нужен для настройки API).
- `GROUP_ID`: Цифровой ID группы.

---

## Устранение неполадок

### Ошибка 403 / HTML в ответе
Если VK не может подтвердить адрес, проверьте Шаг 2. Доступ должен быть "Anyone".

### Ошибки в логах (Журнал)
Все ошибки записываются в лист **Журнал**. Для детальной диагностики включите `debug_logging_enabled` в листе **Настройки**.
